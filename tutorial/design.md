# 网站设计文档

## 概述

晓柳科技AI原理与应用主题网站 - 静态内容展示平台，采用原生JavaScript实现，支持Markdown内容渲染。

## 一、设计要求

### 1.1 主题定位
- **主题**：AI原理与应用
- **风格**：简洁、专业、响应式
- **品牌**：晓柳科技，紫色渐变主题（#667eea → #764ba2）

### 1.2 核心功能
- 双级导航系统（主导航 + 子菜单）
- 文档标题导航（二级子菜单）
- Markdown内容动态加载与渲染
- 响应式布局（桌面端/移动端）
- 移动端侧滑菜单
- 加载进度提示
- 智能缓存机制

## 二、页面布局

### 2.1 整体结构
```
Header (固定顶部)
├─ Logo
└─ 主导航菜单

Main Container
├─ Loading Progress Bar (顶部固定)
├─ Sidebar (左侧边栏/移动端侧滑)
│  └─ 子菜单（可展开/收缩）
│     └─ 文档标题导航（二级子菜单）
└─ Content Area (内容区)
   └─ Markdown渲染内容

Floating Button (仅移动端)
└─ 子菜单浮动按钮
```

### 2.2 响应式断点
- **桌面端**：> 768px - 固定左侧边栏（250px）
- **移动端**：≤ 768px - 侧滑菜单（70%宽度，最大300px）

## 三、导航系统

### 3.1 主导航菜单
配置位于`menu-config.json`，支持动态扩展。

当前菜单结构：
- **LLM原理**：LLM概述、文本的数学表示与编码、注意力机制的原理剖析、Transformer架构深度解析、大规模预训练的原理、生成式推理的数学原理、模型能力涌现的机制
- **AI编程**：提示工程

### 3.2 子菜单
- 根据选中的主导航动态生成
- 支持展开/收缩功能
- 点击加载对应的Markdown文件
- **移动端**：点击后自动关闭侧边栏
- **桌面端**：点击一级菜单时自动收缩其他展开的菜单
- 活动项显示左侧边框和背景色

### 3.3 文档标题导航（二级子菜单）
- **首次加载**：不解析标题，仅显示一级菜单
- **按需加载**：点击一级菜单时动态解析该文件的标题
- 自动解析Markdown文件中的二级标题（##）
- 作为二级子菜单展示
- 点击可跳转到对应标题位置（锚点跳转）

### 3.4 交互行为
- 点击主导航项 → 加载对应子菜单和默认内容
- 默认选中第一个主导航项和第一个子菜单项
- **移动端**：
  - 点击主导航项后直接展示内容，不自动弹出子菜单
  - 点击子菜单项后自动关闭侧边栏
  - 活动状态显示底部边框
- **桌面端**：活动状态显示底部边框

## 四、内容展示

### 4.1 Markdown渲染
- **库**：marked.js v9.1.6
- **本地化**：`libs/marked.min.js`
- **加载检查**：使用轮询机制确保 marked 库完全加载后再使用
- **支持元素**：标题、段落、列表、代码块、表格、引用、链接、图片

### 4.2 内容加载
- 使用`fetch` API异步加载Markdown文件
- **智能缓存**：标题解析和内容渲染共享缓存，避免重复传输
- 加载失败显示错误信息
- 文件不存在显示"内容准备中"

### 4.3 加载进度提示
- **进度条位置**：页面顶部固定
- **进度阶段**：
  - 10%: 加载内容文件
  - 20%: 读取文件内容
  - 30%: 加载 Markdown 解析库
  - 60%: Markdown 解析库加载完成
  - 70%: 解析 Markdown 内容
  - 80%: 渲染 LaTeX 公式
  - 90%: 渲染图表
  - 100%: 加载完成（300ms后自动隐藏）
- **样式**：渐变色进度条，半透明背景

### 4.4 数学公式渲染（KaTeX）
- **库**：KaTeX v0.16.9
- **本地化**：`libs/katex.min.js` / `libs/katex.min.css`
- **支持语法**：
  - 行内公式：`$E=mc^2$`
  - 块级公式：`$$...$$`
- **特性**：
  - 支持复杂的LaTeX数学公式
  - 正确处理大括号嵌套和转义字符
  - 使用占位符机制防止与Markdown解析冲突
  - 自动转义HTML特殊字符防止XSS攻击

### 4.5 图表渲染（Mermaid）
- **库**：Mermaid v10.6.1
- **本地化**：`libs/mermaid.min.js`（按需动态加载）
- **支持图表类型**：流程图、时序图、类图、状态图、甘特图、饼图
- **语法**：使用```mermaid代码块包裹图表代码
- **样式**：图表居中显示，带有浅灰色背景和圆角边框

## 五、技术架构

### 5.1 技术栈
- **HTML5**：语义化标签
- **CSS3**：Flexbox布局，媒体查询
- **JavaScript (ES6+)**：原生JS，无框架依赖
- **第三方库**（本地化部署）：
  - marked.js v9.1.6（Markdown解析）
  - KaTeX v0.16.9（LaTeX数学公式渲染）
  - Mermaid v10.6.1（图表渲染）

### 5.2 文件结构
```
tutorial/
├── index.html              # 主页面
├── styles.css              # 样式文件
├── js/                     # JavaScript模块目录
│   ├── core.js            # 核心配置和状态管理
│   ├── cache.js           # 缓存管理模块
│   ├── menu.js           # 菜单处理模块
│   ├── content.js        # 内容处理模块
│   ├── utils.js          # 工具函数模块
│   └── main.js           # 应用入口模块
├── libs/                   # 第三方库目录
│   ├── marked.min.js
│   ├── katex.min.js
│   ├── katex.min.css
│   ├── auto-render.min.js
│   └── mermaid.min.js
├── menu-config.json        # 菜单配置文件
└── content/                # Markdown内容目录
    ├── llm/                # LLM原理内容
    │   ├── intro.md
    │   ├── text-representation.md
    │   ├── attention-mechanism.md
    │   ├── transformer-architecture.md
    │   ├── pretraining.md
    │   ├── generative-inference.md
    │   └── emergence.md
    └── ai-programming/     # AI编程内容
        └── prompt.md
```

### 5.3 菜单配置
菜单通过`menu-config.json`配置，包含：
- `menuConfig`：主导航配置（标题、排序）
- `fileTitleMap`：文件名到标题的映射
- `fileOrder`：文件排序配置

**配置驱动设计**：
- 所有菜单结构完全从配置文件读取
- 添加新文件夹或文件只需修改配置
- 无需修改JavaScript代码

### 5.4 模块化架构
```
core.js (核心配置)
├─ 全局状态管理
├─ 配置加载
└─ 状态更新函数

cache.js (缓存管理)
├─ localStorage 封装
├─ 缓存过期管理
└─ 缓存键配置

menu.js (菜单处理)
├─ 菜单数据生成
├─ 主导航渲染
├─ 子菜单渲染
└─ 菜单交互逻辑

content.js (内容处理)
├─ Markdown 解析
├─ 内容加载
├─ 标题解析
├─ LaTeX 渲染
├─ Mermaid 渲染
└─ 加载进度控制

utils.js (工具函数)
├─ ID 生成
├─ 标题处理
└─ DOM 操作辅助

main.js (应用入口)
├─ 模块加载
├─ 应用初始化
└─ 移动端菜单控制
```

## 六、样式规范

### 6.1 色彩方案
- **主题渐变**：#667eea → #764ba2
- **背景**：#f5f5f5（页面）、#fff（内容区）
- **文字**：#333（主色）、#555（次色）
- **代码**：#e83e8c（行内）、#2d2d2d（代码块背景）

### 6.2 响应式特性
- **过渡动画**：0.3s ease
- **移动端菜单**：侧滑 + 遮罩层
- **浮动按钮**：右下角圆形按钮（仅移动端）
- **加载进度条**：顶部固定，渐变色

## 七、浏览器兼容性

| 浏览器 | 最低版本 |
|--------|----------|
| Chrome | 90+ |
| Firefox | 88+ |
| Safari | 14+ |
| Edge | 90+ |
| 移动端 | iOS 14+, Android 10+ |

## 八、维护指南

### 8.1 添加新内容
1. 在`content/`对应目录下创建`.md`文件
2. 在`menu-config.json`中添加文件标题映射和排序
3. 刷新页面即可

### 8.2 添加新分类
1. 在`content/`下创建新文件夹
2. 在`menu-config.json`的`menuConfig`中添加分类配置
3. 在`fileOrder`中添加该分类的文件顺序
4. 刷新页面即可

### 8.3 修改样式
编辑`styles.css`，使用CSS变量便于主题定制。

### 8.4 修改菜单结构
编辑`menu-config.json`调整菜单配置，无需修改JavaScript代码。

## 九、部署

### 9.1 本地开发
```bash
cd tutorial
python -m http.server 3000
```

### 9.2 服务器部署
静态文件部署至Web服务器（Nginx/Apache），配置适当的缓存策略。

## 十、性能优化

### 10.1 资源加载优化

#### 10.1.1 预连接和DNS预解析
- **实现方式**：在 `index.html` 头部添加预连接指令
- **具体配置**：
  ```html
  <link rel="preconnect" href="https://cdn.bootcdn.net">
  <link rel="dns-prefetch" href="https://cdn.bootcdn.net">
  ```
- **作用**：提前建立与CDN的连接，减少DNS解析和TCP握手时间

#### 10.1.2 资源预加载
- **实现方式**：使用 `<link rel="preload">` 预加载关键资源
- **具体配置**：
  ```html
  <link rel="preload" href="styles.css" as="style">
  ```
- **作用**：提前加载关键CSS文件，避免渲染阻塞

#### 10.1.3 库文件本地化部署
- **实现方式**：所有第三方库文件下载至本地 `libs/` 目录
- **本地库文件**：
  - `libs/marked.min.js` - Markdown解析
  - `libs/katex.min.js` / `libs/katex.min.css` - 数学公式渲染
  - `libs/auto-render.min.js` - KaTeX自动渲染
  - `libs/mermaid.min.js` - 图表渲染（按需加载）
- **优势**：
  - 减少外部依赖，提高加载稳定性
  - 国内访问速度快，无需翻墙
  - 避免CDN失效导致页面功能异常

### 10.2 缓存机制

#### 10.2.1 缓存策略
- **缓存介质**：浏览器 `localStorage`
- **缓存过期时间**：24小时（`24 * 60 * 60 * 1000` 毫秒）

#### 10.2.2 缓存内容
| 缓存类型 | 缓存键名 | 说明 |
|----------|----------|------|
| 菜单数据缓存 | `tutorial_menu_cache_v1` | 包含文件结构和标题信息 |
| 内容缓存 | `tutorial_content_cache_v1_<文件路径>` | Markdown文件内容 |

#### 10.2.3 缓存实现（`cache.js`）
```javascript
export const CACHE_CONFIG = {
    menuData: 'tutorial_menu_cache_v1',
    content: 'tutorial_content_cache_v1',
    expiry: 24 * 60 * 60 * 1000
};
```

#### 10.2.4 智能缓存管理
- **自动过期清理**：缓存过期后自动清除
- **错误处理**：缓存操作失败时 graceful degradation
- **缓存命中日志**：控制台输出缓存使用情况（开发调试用）

#### 10.2.5 共享缓存机制
- **标题解析和内容渲染共享缓存**：避免重复下载文件
- **缓存优先策略**：先检查缓存，缓存命中则直接使用
- **按需缓存**：首次访问文件时自动缓存，后续访问直接使用

### 10.3 按需加载策略

#### 10.3.1 菜单标题按需加载
- **首次加载**：仅使用 `menu-config.json` 构建一级菜单
- **标题加载时机**：用户点击一级菜单时才解析该文件的标题
- **避免全量扫描**：不遍历 `content/` 目录，不发送 HEAD 请求
- **文件夹列表**：从 `menuConfig` 动态获取，支持任意扩展

#### 10.3.2 文件传输优化
- **单次传输**：每个 Markdown 文件只传输一次
- **缓存共享**：标题解析和内容渲染使用同一缓存
- **避免重复**：解析标题时先检查缓存，缓存命中则直接使用

#### 10.3.3 延迟加载策略
- **Mermaid图表**：按需加载，仅在页面中存在 `code.language-mermaid` 时加载
- **实现方式**：使用动态 `import` 或创建 script 标签懒加载

#### 10.3.4 库加载状态检查
- **marked 库**：使用轮询机制确保完全加载后再使用
- **超时保护**：最长等待 10 秒，超时后抛出错误
- **用户体验**：显示加载进度条，避免用户困惑

### 10.4 渲染性能优化

#### 10.4.1 公式渲染优化
- **占位符机制**：使用占位符防止LaTeX公式与Markdown解析冲突
- **分步渲染**：先渲染Markdown，再渲染LaTeX公式，最后渲染Mermaid图表
- **大括号嵌套处理**：正确处理LaTeX中的大括号嵌套和转义字符

#### 10.4.2 滚动定位优化
- **延迟执行**：标题锚点跳转使用 `setTimeout(..., 200)` 确保DOM渲染完成
- **偏移计算**：考虑固定头部高度，留出适当间距

### 10.5 CSS性能优化

#### 10.5.1 过渡动画优化
- **统一过渡时间**：使用 `0.3s ease` 作为标准过渡时间
- **优化属性**：仅对必要属性添加过渡效果（`transition: all` 需谨慎使用）
- **硬件加速**：使用 `transform` 和 `opacity` 等GPU加速属性

#### 10.5.2 响应式布局优化
- **媒体查询**：合理设置断点（768px）
- **移动端优化**：侧滑菜单使用 `transform: translateX` 而非改变 width

## 十一、性能提升效果

### 11.1 首次加载优化
- **优化前**：下载所有 markdown 文件解析标题
- **优化后**：仅使用配置文件，不下载任何内容
- **提升**：减少 80-90% 初始数据传输量

### 11.2 按需加载优化
- **标题解析**：点击一级菜单时才加载
- **文件传输**：每个文件只传输一次
- **提升**：减少 50% 不必要的数据传输

### 11.3 缓存优化
- **缓存共享**：标题解析和内容渲染共享缓存
- **缓存优先**：重复访问直接使用缓存
- **提升**：重复访问减少 70-80% 加载时间

## 十二、常见问题

### 12.1 为什么不使用 CDN？
- 国内访问速度不稳定
- 可能被墙
- 本地化部署更稳定

### 12.2 为什么不使用框架？
- 保持轻量级
- 学习成本低
- 易于维护

### 12.3 如何添加新功能？
- 修改 `menu-config.json` 配置
- 在 `content/` 目录添加内容
- 无需修改 JavaScript 代码

## 十三、版本历史

### v1.0 (2024-01-01)
- 初始版本
- 基础导航和内容展示

### v1.1 (2024-01-15)
- 添加移动端支持
- 优化响应式布局

### v1.2 (2024-02-01)
- 添加加载进度条
- 优化缓存机制
- 实现按需加载

### v1.3 (2024-02-14)
- 移除硬编码配置
- 实现配置驱动设计
- 优化文件传输策略
- 添加移动端交互优化
